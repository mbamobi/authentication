<h1 id="user-content-fluid-publish" class="deep-link"><a href="#fluid-publish">fluid-publish</a></h1>
<p>A command line tool and node module that can be used to simplify the process of publishing a module to NPM. This is particularly useful for creating development releases, e.g. nightly or continuous integration releases.</p>
<p>By default this will create a release with version <strong>X.x.x-prerelease.yyyymmddThhmmssZ.shortHash</strong> where <strong>X.x.x</strong> is sourced from the version number in the package.json file, <strong>-prerelease</strong> is from the <code>devTag</code> option (also applied as a tag to the release), and the <strong>yyyymmddThhmmssZ.shortHash</strong> build identifier is generated based on the latest commit.</p>
<h2 id="user-content-installation" class="deep-link"><a href="#installation">Installation</a></h2>
<pre><code class="highlight bash"><pre class="editor editor-colors"><div class="line"><span class="text"><span>#&#xA0;global&#xA0;install</span></span></div><div class="line"><span class="text"><span>npm&#xA0;install&#xA0;fluid-publish&#xA0;-g</span></span></div><div class="line"><span class="text"><span>&#xA0;</span></span></div><div class="line"><span class="text"><span>#&#xA0;local&#xA0;dev&#xA0;install</span></span></div><div class="line"><span class="text"><span>npm&#xA0;install&#xA0;fluid-publish&#xA0;--save-dev</span></span></div></pre></code></pre>
<h2 id="user-content-usage" class="deep-link"><a href="#usage">Usage</a></h2>
<h3 id="user-content-command-line" class="deep-link"><a href="#command-line">Command Line</a></h3>
<p>Run these commands from the root directory of the module to be published.</p>
<pre><code class="highlight bash"><pre class="editor editor-colors"><div class="line"><span class="text"><span>#&#xA0;creates&#xA0;a&#xA0;dev&#xA0;release&#xA0;(global&#xA0;install)</span></span></div><div class="line"><span class="text"><span>fluid-publish</span></span></div><div class="line"><span class="text"><span>&#xA0;</span></span></div><div class="line"><span class="text"><span>#&#xA0;creates&#xA0;a&#xA0;dev&#xA0;release&#xA0;(local&#xA0;install)</span></span></div><div class="line"><span class="text"><span>./node_modules/.bin/fluid-publish</span></span></div></pre></code></pre>
<h4 id="user-content-standard" class="deep-link"><a href="#standard">--standard</a></h4>
<p><strong>value</strong>: true (Boolean)</p>
<p>Specifies that a standard release should be generated. This creates a release named after the version in the package.json file. It will not increase the version number.</p>
<pre><code class="highlight bash"><pre class="editor editor-colors"><div class="line"><span class="text"><span>#&#xA0;creates&#xA0;a&#xA0;standard&#xA0;release</span></span></div><div class="line"><span class="text"><span>fluid-publish&#xA0;--standard</span></span></div></pre></code></pre>
<h4 id="user-content-test" class="deep-link"><a href="#test">--test</a></h4>
<p><strong>value</strong>: true (Boolean)</p>
<p>Specifies that a tarball should be created instead of publishing to NPM. This is useful to use a means of testing that the publish will happen correctly.</p>
<pre><code class="highlight bash"><pre class="editor editor-colors"><div class="line"><span class="text"><span>#&#xA0;creates&#xA0;a&#xA0;tarball</span></span></div><div class="line"><span class="text"><span>fluid-publish&#xA0;--test</span></span></div><div class="line"><span class="text"><span>fluid-publish&#xA0;--test&#xA0;--standard</span></span></div><div class="line"><span class="text"><span>&#xA0;</span></span></div><div class="line"><span class="text"><span>#&#xA0;publishes&#xA0;to&#xA0;NPM</span></span></div><div class="line"><span class="text"><span>fluid-publish</span></span></div><div class="line"><span class="text"><span>fluid-publish&#xA0;--standard</span></span></div></pre></code></pre>
<h4 id="user-content-options" class="deep-link"><a href="#options">--options</a></h4>
<p><strong>value</strong>: {String} stringified JSON object</p>
<p>A stringified JSON object containing overrides to the default options used across the publish script. The defaults can be found in publish.js&apos;s <a href="package.json">package.json</a> file under the <code>defaultOptions</code> key.</p>
<p>(See: <a href="#options">Options</a>)</p>
<pre><code class="highlight bash"><pre class="editor editor-colors"><div class="line"><span class="text"><span>#&#xA0;publishes&#xA0;a&#xA0;dev&#xA0;build&#xA0;and&#xA0;applies&#xA0;the&#xA0;tag&#xA0;&quot;nightly&quot;&#xA0;to&#xA0;it</span></span></div><div class="line"><span class="text"><span>fluid-publish&#xA0;--options=&quot;{&apos;devTag&apos;:&#xA0;&apos;nightly&apos;}&quot;</span></span></div></pre></code></pre>
<h3 id="user-content-node" class="deep-link"><a href="#node">Node</a></h3>
<h5 id="user-content-parameters" class="deep-link"><a href="#parameters">parameters</a></h5>
<ul>
<li>isTest {Boolean} - Indicates if this is a test run, if true a tarball will be generated instead of publishing to NPM.</li>
<li>options {Object} - The defaults can be found in publish.js&apos;s <a href="package.json">package.json</a> file under the <code>defaultOptions</code> key. (See: <a href="#options">Options</a>)</li>
</ul>
<h4 id="user-content-dev" class="deep-link"><a href="#dev"><code>dev</code></a></h4>
<p>Publishes a development build. This creates a release named after the version, but with the build stamp appended to the end. By default this will create a release with version X.x.x-prerelease.yyyymmddThhmmssZ.shortHash where X.x.x is sourced from the version number in the package.json file, -prerelease is from the <code>devTag</code> option (also applied as a tag to the release), and the build identifier (yyyymmddThhmmssZ.shortHash) is generated based on the latest commit.</p>
<pre><code class="highlight javascript"><pre class="editor editor-colors"><div class="line"><span class="source js"><span class="storage modifier js"><span>var</span></span><span>&#xA0;publish&#xA0;</span><span class="keyword operator js"><span>=</span></span><span>&#xA0;</span><span class="support function js"><span>require</span></span><span class="meta brace round js"><span>(</span></span><span class="string quoted double js"><span class="punctuation string begin js"><span>&quot;</span></span><span>fluid-publish</span><span class="punctuation string end js"><span>&quot;</span></span></span><span class="meta brace round js"><span>)</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>publish</span><span class="meta delimiter method period js"><span>.</span></span><span>dev</span><span class="meta brace round js"><span>(</span><span>)</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div></pre></code></pre>
<h5 id="user-content-parameters" class="deep-link"><a href="#parameters">parameters</a></h5>
<ul>
<li>isTest {Boolean} - Indicates if this is a test run, if true a tarball will be generated instead of publishing to NPM.</li>
<li>options {Object} - The defaults can be found in publish.js&apos;s <a href="package.json">package.json</a> file under the <code>defaultOptions</code> key. (See: <a href="#options">Options</a>)</li>
</ul>
<h4 id="user-content-standard" class="deep-link"><a href="#standard"><code>standard</code></a></h4>
<p>Publishes a release build. This creates a release named after the version in the package.json file. By default it will not increase the version number, this must be done separately.</p>
<pre><code class="highlight javascript"><pre class="editor editor-colors"><div class="line"><span class="source js"><span class="storage modifier js"><span>var</span></span><span>&#xA0;publish&#xA0;</span><span class="keyword operator js"><span>=</span></span><span>&#xA0;</span><span class="support function js"><span>require</span></span><span class="meta brace round js"><span>(</span></span><span class="string quoted double js"><span class="punctuation string begin js"><span>&quot;</span></span><span>fluid-publish</span><span class="punctuation string end js"><span>&quot;</span></span></span><span class="meta brace round js"><span>)</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>publish</span><span class="meta delimiter method period js"><span>.</span></span><span>standard</span><span class="meta brace round js"><span>(</span><span>)</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div></pre></code></pre>
<h2 id="user-content-options" class="deep-link"><a href="#options">Options</a></h2>
<table>
    <thead>
        <tr>
            <th>
                Option
            </th>
            <th>
                Description
            </th>
            <th>
                Default
            </th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>
                <code>changesCmd</code>
            </td>
            <td>
                The CLI to execute which determines if there are any uncommitted changes. It should return a string of changes, or nothing.
            </td>
            <td>
                &quot;git status -s -uno&quot;
            </td>
        </tr>
        <tr>
            <td>
                <code>rawTimestampCmd</code>
            </td>
            <td>
                The CLI to execute which returns a git format timestamp for the most recent commit.
            </td>
            <td>
                &quot;git show -s --format=%ct HEAD&quot;
            </td>
        </tr>
        <tr>
            <td>
                <code>revisionCmd</code>
            </td>
            <td>
                The CLI to execute which returns the most recent commit revision number/hash.
            </td>
            <td>
                &quot;git rev-parse --verify --short HEAD&quot;
            </td>
        </tr>
        <tr>
            <td>
                <code>packCmd</code>
            </td>
            <td>
                The CLI to execute which constructs a tarball of the release artifact.
            </td>
            <td>
                &quot;npm pack&quot;
            </td>
        </tr>
        <tr>
            <td>
                <code>publishCmd</code>
            </td>
            <td>
                The CLI to execute which publishes a release to NPM.
            </td>
            <td>
                &quot;npm publish&quot;
            </td>
        </tr>
        <tr>
            <td>
                <code>versionCmd</code>
            </td>
            <td>
                The CLI to execute which sets the dev version to release under.
                <ul>
                    <li>
                        <code>${version}</code> will be substituted with the generated dev build version.
                    </li>
                </ul>
            </td>
            <td>
                &quot;npm version --no-git-tag-version ${version}&quot;
                <br>
                <br>
                <p>
                    <em><strong>NOTE</strong>: This command will update the version in the package.json file, but will not commit the change.</em>
                </p>
            </td>
        </tr>
        <tr>
            <td>
                <code>distTagCmd</code>
            </td>
            <td>
                The CLI to execute which tags an NPM release.
                <ul>
                    <li>
                        <code>${packageName}</code> will be substituted with executing module&apos;s name.
                    </li>
                    <li>
                        <code>${version}</code> will be substituted with the generated dev build version.
                    </li>
                    <li>
                        <code>${tag}</code>will be substituted with the value from the <code>devTag</code> option.
                    </li>
                </ul>
            </td>
            <td>
                &quot;npm dist-tag add ${packageName}@${version} ${tag}&quot;
                <br>
                <br>
                <p>
                    <em><strong>NOTE</strong>: This command will update the version in the package.json file, but will not commit the change.</em>
                </p>
            </td>
        </tr>
        <tr>
            <td>
                <code>cleanCmd</code>
            </td>
            <td>
                The CLI to execute which cleans up any temporary changes to the package.json file.
                <ul>
                    <li>
                        <code>${package}</code> will be substituted with the path to the executing modules package.json file.
                    </li>
                </ul>
            </td>
            <td>
                &quot;git checkout -- ${package}&quot;
            </td>
        </tr>
        <tr>
            <td>
                <code>devVersion</code>
            </td>
            <td>
                The string template for constructing a dev release version number.
                <ul>
                    <li>
                        <code>${version}</code> will be substituted with the version in the package.json file.
                    </li>
                    <li>
                        <code>${timestamp}</code> will be substituted with the generated ISO8601 timestamp based on the most recent commit.
                    </li>
                    <li>
                        <code>${revision}</code> will be substituted with the revision/hash of the most recent commit.
                    </li>
                </ul>    
            </td>
            <td>
                &quot;${version}.${timestamp}.${revision}&quot;
            </td>
        </tr>
        <tr>
            <td>
                <code>devTag</code>
            </td>
            <td>
                The tag name to use for tagging dev releases.
            </td>
            <td>
                &quot;dev&quot;
            </td>
        </tr>
    </tbody>
</table>
<h2 id="user-content-publishing-itself" class="deep-link"><a href="#publishing-itself">Publishing Itself</a></h2>
<p>Publish can publish itself to NPM. This can be done using any of the <a href="#usage">usage</a> methods described above, or via the NPM <code>pub</code> script defined in <a href="package.json">package.json</a>. The script makes use of the command line interface provided to interact with publish.js. However, with NPM you&apos;ll need to provide a set of &quot;--&quot; to identify arguments to the script.</p>
<pre><code class="highlight bash"><pre class="editor editor-colors"><div class="line"><span class="text"><span>#&#xA0;publishes&#xA0;a&#xA0;dev&#xA0;release&#xA0;to&#xA0;NPM</span></span></div><div class="line"><span class="text"><span>npm&#xA0;run&#xA0;pub</span></span></div><div class="line"><span class="text"><span>&#xA0;</span></span></div><div class="line"><span class="text"><span>#&#xA0;publishes&#xA0;a&#xA0;standard&#xA0;release&#xA0;to&#xA0;NPM</span></span></div><div class="line"><span class="text"><span>npm&#xA0;run&#xA0;pub&#xA0;--&#xA0;--standard</span></span></div></pre></code></pre>
